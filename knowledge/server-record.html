<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>部署一台属于自己的服务器 | Jamescain Blog</title>
    <meta name="description" content="A knowledge blog">
    <link rel="icon" href="/knowledge-note/favicon.ico">
    
    <link rel="preload" href="/knowledge-note/assets/css/0.styles.2a62c23f.css" as="style"><link rel="preload" href="/knowledge-note/assets/js/app.5911ee68.js" as="script"><link rel="preload" href="/knowledge-note/assets/js/39.503b146a.js" as="script"><link rel="prefetch" href="/knowledge-note/assets/js/10.c06c8013.js"><link rel="prefetch" href="/knowledge-note/assets/js/11.e009d5ba.js"><link rel="prefetch" href="/knowledge-note/assets/js/12.7bd7ec08.js"><link rel="prefetch" href="/knowledge-note/assets/js/13.f7dd9fff.js"><link rel="prefetch" href="/knowledge-note/assets/js/14.2a1937c1.js"><link rel="prefetch" href="/knowledge-note/assets/js/15.dd234ab4.js"><link rel="prefetch" href="/knowledge-note/assets/js/16.aa68018a.js"><link rel="prefetch" href="/knowledge-note/assets/js/17.450ded1b.js"><link rel="prefetch" href="/knowledge-note/assets/js/18.e5ab91c5.js"><link rel="prefetch" href="/knowledge-note/assets/js/19.828f0cfd.js"><link rel="prefetch" href="/knowledge-note/assets/js/2.5416267e.js"><link rel="prefetch" href="/knowledge-note/assets/js/20.1f74175f.js"><link rel="prefetch" href="/knowledge-note/assets/js/21.ecc13655.js"><link rel="prefetch" href="/knowledge-note/assets/js/22.25b8b23e.js"><link rel="prefetch" href="/knowledge-note/assets/js/23.da0530a5.js"><link rel="prefetch" href="/knowledge-note/assets/js/24.adf76fe9.js"><link rel="prefetch" href="/knowledge-note/assets/js/25.c0a039ad.js"><link rel="prefetch" href="/knowledge-note/assets/js/26.41bf7655.js"><link rel="prefetch" href="/knowledge-note/assets/js/27.8cb8f7aa.js"><link rel="prefetch" href="/knowledge-note/assets/js/28.3ece7860.js"><link rel="prefetch" href="/knowledge-note/assets/js/29.5b309485.js"><link rel="prefetch" href="/knowledge-note/assets/js/3.eba998b9.js"><link rel="prefetch" href="/knowledge-note/assets/js/30.9d5ec625.js"><link rel="prefetch" href="/knowledge-note/assets/js/31.8e9db55d.js"><link rel="prefetch" href="/knowledge-note/assets/js/32.130120c0.js"><link rel="prefetch" href="/knowledge-note/assets/js/33.d0be234c.js"><link rel="prefetch" href="/knowledge-note/assets/js/34.8e7b7627.js"><link rel="prefetch" href="/knowledge-note/assets/js/35.7fb44f32.js"><link rel="prefetch" href="/knowledge-note/assets/js/36.03fd684d.js"><link rel="prefetch" href="/knowledge-note/assets/js/37.0bb053eb.js"><link rel="prefetch" href="/knowledge-note/assets/js/38.3ed9aa63.js"><link rel="prefetch" href="/knowledge-note/assets/js/4.f9b24404.js"><link rel="prefetch" href="/knowledge-note/assets/js/40.79121f99.js"><link rel="prefetch" href="/knowledge-note/assets/js/41.443d405d.js"><link rel="prefetch" href="/knowledge-note/assets/js/42.14497441.js"><link rel="prefetch" href="/knowledge-note/assets/js/5.7fd892d4.js"><link rel="prefetch" href="/knowledge-note/assets/js/6.c5949721.js"><link rel="prefetch" href="/knowledge-note/assets/js/7.bd690ea3.js"><link rel="prefetch" href="/knowledge-note/assets/js/8.0d238870.js"><link rel="prefetch" href="/knowledge-note/assets/js/9.0baaa73c.js">
    <link rel="stylesheet" href="/knowledge-note/assets/css/0.styles.2a62c23f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/knowledge-note/" class="home-link router-link-active"><!----> <span class="site-name">Jamescain Blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/knowledge-note/knowledge/" class="nav-link router-link-active">知识库</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://twitter.com/Jamescain_lll" target="_blank" rel="noopener noreferrer" class="nav-link external">
  作者twitter
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/james-cain/My-lab" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/knowledge-note/knowledge/" class="nav-link router-link-active">知识库</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://twitter.com/Jamescain_lll" target="_blank" rel="noopener noreferrer" class="nav-link external">
  作者twitter
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/james-cain/My-lab" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>基础</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/knowledge-note/knowledge/Damn-hole-of-html5.html" class="sidebar-link">html5</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-CSS3.html" class="sidebar-link">CSS3</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-javascript.html" class="sidebar-link">JavaScript</a></li><li><a href="/knowledge-note/knowledge/review-the-javascript.html" class="sidebar-link">ES6</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-design-patterns.html" class="sidebar-link">Design Patterns-设计模式</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-http.html" class="sidebar-link">http/http2/https</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>进阶</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/knowledge-note/knowledge/Damn-hole-of-webapi.html" class="sidebar-link">WebAPI</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-Browser.html" class="sidebar-link">Browser</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-google-devtools.html" class="sidebar-link">google devtools</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-network.html" class="sidebar-link">网络</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-safe-and-hacker.html" class="sidebar-link">网络安全</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-javascript-algonithms.html" class="sidebar-link">JavaScript数据结构</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-performance.html" class="sidebar-link">性能优化</a></li><li><a href="/knowledge-note/knowledge/parameters-of-package.html" class="sidebar-link">详解package.json</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>工具</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/knowledge-note/knowledge/Damn-hole-of-babel.html" class="sidebar-link">babel7</a></li><li><a href="/knowledge-note/knowledge/webpack-perf.html" class="sidebar-link">Webpack打包优化</a></li><li><a href="/knowledge-note/knowledge/webpack-source-learning.html" class="sidebar-link">webpack源码</a></li><li><a href="/knowledge-note/knowledge/how-to-use-npm-sonatype.html" class="sidebar-link">用sonatype3搭建npm私服</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>拓展</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/knowledge-note/knowledge/Damn-hole-of-pwa.html" class="sidebar-link">PWA</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>浏览器详解</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/knowledge-note/knowledge/Damn-hole-of-chromium.html" class="sidebar-link">Chromium</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-V8.html" class="sidebar-link">V8</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-blink.html" class="sidebar-link">Blink</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>其他</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/knowledge-note/knowledge/server-record.html" class="active sidebar-link">部署一台属于自己的服务器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/server-record.html#文件夹的含义" class="sidebar-link">文件夹的含义</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/server-record.html#rpm和yum的解释" class="sidebar-link">rpm和yum的解释</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/server-record.html#创建新用户密码" class="sidebar-link">创建新用户密码</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/server-record.html#赋予新用户sudo权限" class="sidebar-link">赋予新用户sudo权限</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/server-record.html#ssh中新增加用户没有显示用户名" class="sidebar-link">ssh中新增加用户没有显示用户名</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/server-record.html#安装nodejs" class="sidebar-link">安装nodejs</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/server-record.html#安装mysql" class="sidebar-link">安装mysql</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/server-record.html#nginx添加http-2支持" class="sidebar-link">nginx添加http/2支持</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="部署一台属于自己的服务器"><a href="#部署一台属于自己的服务器" aria-hidden="true" class="header-anchor">#</a> 部署一台属于自己的服务器</h1> <p>在写这篇文章之前，其实有过一些服务端的基础知识，但是从来没有从零开始搭建服务器，趁着那天阿里云服务器相当之便宜，抱着玩的心态买了三年，感觉收获还是很多的，自己搭了python、mysql、nginx、node、http2、https、域名、域名认证，还是蛮有意思的~接下来记录下搭建的笔记</p> <h2 id="文件夹的含义"><a href="#文件夹的含义" aria-hidden="true" class="header-anchor">#</a> 文件夹的含义</h2> <p>/root</p> <pre><code>这是系统管理员(root user)的目录。对于系统来说，系统管理员就好比是上帝，它能对系统做任何事情，甚至包括删除你的文件。因此，请小心使用root帐号。
</code></pre> <p>/bin</p> <pre><code>这里存放了标准的(或者说是缺省的)linux的工具，比如像“ls”、“vi”还有“more”等等。通常来说，这个目录已经包含在你的“path”系 统变量里面了。什么意思呢?就是：当你在终端里输入ls，系统就会去/bin目录下面查找是不是有ls这个程序。
</code></pre> <p>/etc</p> <pre><code>这里主要存放了系统配置方面的文件。举个例子：你安装了samba这个套件，当你想要修改samba配置文件的时候，你会发现它们(配置文件)就在/etc/samba目录下。
</code></pre> <p>/dev</p> <pre><code>这里主要存放与设备(包括外设)有关的文件(unix和linux系统均把设备当成文件)。想连线打印机吗?系统就是从这个目录开始工作的。另外还有一些包括磁盘驱动、USB驱动等都放在这个目录。
</code></pre> <p>/home</p> <pre><code>这里主要存放你的个人数据。具体每个用户的设置文件，用户的桌面文件夹，还有用户的数据都放在这里。每个用户都有自己的用户目录，位置为：/home/用户名。当然，root用户除外。
</code></pre> <p>/usr</p> <pre><code>在这个目录下，你可以找到那些不适合放在/bin或/etc目录下的额外的工具。比如像游戏阿，一些打印工具拉等等。/usr目录包含了许多子目录： /usr/bin目录用于存放程序;/usr/share用于存放一些共享的数据，比如音乐文件或者图标等等;/usr/lib目录用于存放那些不能直接 运行的，但却是许多程序运行所必需的一些函数库文件。你的软件包管理器(应该是“新立得”吧)会自动帮你管理好/usr目录的。
</code></pre> <p>/opt</p> <pre><code>这里主要存放那些可选的程序。你想尝试最新的firefox测试版吗?那就装到/opt目录下吧，这样，当你尝试完，想删掉firefox的时候，你就可 以直接删除它，而不影响系统其他任何设置。安装到/opt目录下的程序，它所有的数据、库文件等等都是放在同个目录下面。

举个例子：刚才装的测试版firefox，就可以装到/opt/firefox_beta目录下，/opt/firefox_beta目录下面就包含了运 行firefox所需要的所有文件、库、数据等等。要删除firefox的时候，你只需删除/opt/firefox_beta目录即可，非常简单。
</code></pre> <p>/usr/local</p> <pre><code>这里主要存放那些手动安装的软件，即不是通过“新立得”或apt-get安装的软件。它和/usr目录具有相类似的目录结构。让软件包管理器来管理/usr目录，而把自定义的脚本(scripts)放到/usr/local目录下面，我想这应该是个不错的主意。
</code></pre> <p>/media</p> <pre><code>有些linux的发行版使用这个目录来挂载那些usb接口的移动硬盘(包括U盘)、CD/DVD驱动器等等。创建新用户
</code></pre> <blockquote><p>useradd -d /home/cain -m cain</p></blockquote> <p>useradd 主要参数：</p> <pre><code>-c：加上备注文字，备注文字保存在passwd的备注栏中。
</code></pre> <p>-d：指定用户登入时的主目录，替换系统默认值/home/&lt;用户名&gt;</p> <p>-D：变更预设值。</p> <p>-e：指定账号的失效日期，日期格式为MM/DD/YY，例如06/30/12。缺省表示永久有效。</p> <p>-f：指定在密码过期后多少天即关闭该账号。如果为0账号立即被停用；如果为-1则账号一直可用。默认值为-1.</p> <p>-g：指定用户所属的群组。值可以使组名也可以是GID。用户组必须已经存在的，期默认值为100，即users。</p> <p>-G：指定用户所属的附加群组。</p> <p>-m：自动建立用户的登入目录。</p> <p>-M：不要自动建立用户的登入目录。</p> <p>-n：取消建立以用户名称为名的群组。</p> <p>-r：建立系统账号。</p> <p>-s：指定用户登入后所使用的shell。默认值为/bin/bash。</p> <p>-u：指定用户ID号。该值在系统中必须是唯一的。0~499默认是保留给系统用户账号使用的，所以该值必须大于499。</p> <h2 id="rpm和yum的解释"><a href="#rpm和yum的解释" aria-hidden="true" class="header-anchor">#</a> rpm和yum的解释</h2> <blockquote><p>rpm是系统的软件管理程序，可以安装、卸载、查询已经下载的rpm包  rpm只能安装本地已经下载好的包
yum是专用的在线安装软件，会联网查询，下载对应的包，然后安装（安装过程应该也是调用rpm装的，具体没了解过）</p></blockquote> <h2 id="创建新用户密码"><a href="#创建新用户密码" aria-hidden="true" class="header-anchor">#</a> 创建新用户密码</h2> <blockquote><p>sudo passwd cain</p></blockquote> <h2 id="赋予新用户sudo权限"><a href="#赋予新用户sudo权限" aria-hidden="true" class="header-anchor">#</a> 赋予新用户sudo权限</h2> <p>在centos中可能会出现</p> <div class="language- extra-class"><pre class="language-text"><code>usermod: group 'sudo' does not exist
</code></pre></div><p>因为centos默认没有sudo组，可以讲用户指向wheel用户组，wheel用户组同样有sudo权限</p> <p>所以在centos上可以使用如下命令添加用户组</p> <blockquote><p>sudo usermod -a -G wheel cain</p></blockquote> <p>或</p> <p>echo &quot;comtop       ALL=(ALL)       NOPASSWD: ALL&quot; &gt;&gt;/etc/sudoers  该命令将该用户添加为管理员</p> <p><strong>注</strong> 当在非root管理员下 要执行普通用户不能做的事时，要用sudo -i命令切换为管理员，此时才能执行，如修改系统配置的时候</p> <h2 id="ssh中新增加用户没有显示用户名"><a href="#ssh中新增加用户没有显示用户名" aria-hidden="true" class="header-anchor">#</a> ssh中新增加用户没有显示用户名</h2> <p><img src="http://reyshieh.com/assets/sshnoshowusername.png" alt="ssh没有显示用户名"></p> <p>原因是  创建用户的时候，手动把目录给删了  重新添加了目录，导致默认配置信息被修改后，显示不了</p> <h2 id="安装nodejs"><a href="#安装nodejs" aria-hidden="true" class="header-anchor">#</a> 安装nodejs</h2> <h3 id="首先安装wget"><a href="#首先安装wget" aria-hidden="true" class="header-anchor">#</a> 首先安装wget</h3> <blockquote><p>yum install -y wget</p></blockquote> <h3 id="下载最新的nodejs的bin包"><a href="#下载最新的nodejs的bin包" aria-hidden="true" class="header-anchor">#</a> 下载最新的nodejs的bin包</h3> <blockquote><p>wget https://nodejs.org/dist/v9.11.1/node-v9.11.1-linux-x64.tar.xz</p></blockquote> <h3 id="解压包"><a href="#解压包" aria-hidden="true" class="header-anchor">#</a> 解压包</h3> <p>依次执行</p> <blockquote><p>xz -d node-v9.11.1-linux-x64.tar.xz
tar -xf node-v9.11.1-linux-x64.tar</p></blockquote> <h4 id="xz压缩文件方法或命令"><a href="#xz压缩文件方法或命令" aria-hidden="true" class="header-anchor">#</a> xz压缩文件方法或命令</h4> <p>xz -z 要压缩的文件</p> <p>如果要保留被压缩的文件加上参数 -k ，如果要设置压缩率加入参数 -0 到 -9调节压缩率。如果不设置，默认压缩等级是6.</p> <h4 id="xz解压文件方法或命令"><a href="#xz解压文件方法或命令" aria-hidden="true" class="header-anchor">#</a> xz解压文件方法或命令</h4> <p>xz -d 要解压的文件</p> <p>同样使用 -k 参数来保留被解压缩的文件</p> <h4 id="创建tar-xz文件"><a href="#创建tar-xz文件" aria-hidden="true" class="header-anchor">#</a> 创建tar.xz文件</h4> <p>先tar cvf xxx.tar xxx/这样创建xxx.tar文件先，然后使用xz -z xxx.tar 将xxx.tar压缩成为xxx.tar.xz</p> <h4 id="解压tar-xz文件"><a href="#解压tar-xz文件" aria-hidden="true" class="header-anchor">#</a> 解压tar.xz文件</h4> <p>先xz -d xxx.tar.xz 将xxx.tar.xz解压成xxx.tar 然后，再用tar xvf xxx.tar解包</p> <h5 id="tar命令参数"><a href="#tar命令参数" aria-hidden="true" class="header-anchor">#</a> tar命令参数</h5> <blockquote><p>打包： tar -cf soft.tar soft</p> <p><strong>解包： tar -xf soft.tar soft</strong></p> <p><strong>压缩目录</strong></p> <p><strong>打包压缩：tar czvf usr.tar.gz /home</strong></p> <p>解压缩：tar xzvf usr.tar.gz</p> <p><strong>压缩文件（对于目录失效）</strong></p> <p><strong>压缩：zip good.zip good1 good2</strong></p> <p>解压：unzip good.zip</p></blockquote> <blockquote><p>z：使用gz压缩格式 gz=gunzip；使用deflate压缩算法，LZ77算法的进化版，Philip Katz（作者），所有的zip格式都使用这种算法</p> <p>x：解包</p> <p>c：打包</p> <p>v：显示过程</p> <p>f= --file：后面指定包的文件名</p></blockquote> <h3 id="部署bin文件"><a href="#部署bin文件" aria-hidden="true" class="header-anchor">#</a> 部署bin文件</h3> <p>依次执行</p> <blockquote><p>ln -s /home/cain/node-v9.11.1-linux-x64/bin/node /usr/bin/node</p> <p>ln -s /home/cain/node-v9.11.1-linux-x64/bin/npm /usr/bin/npm</p></blockquote> <p>ln指令用于创建关联（类似于windows的快捷方式）必须给全路径，否则可能关联错误</p> <h2 id="安装mysql"><a href="#安装mysql" aria-hidden="true" class="header-anchor">#</a> 安装mysql</h2> <h3 id="下载mysql的repo源"><a href="#下载mysql的repo源" aria-hidden="true" class="header-anchor">#</a> 下载mysql的repo源</h3> <blockquote><p>wget http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpm</p></blockquote> <h4 id="rpm"><a href="#rpm" aria-hidden="true" class="header-anchor">#</a> rpm</h4> <h5 id="安装rpm"><a href="#安装rpm" aria-hidden="true" class="header-anchor">#</a> 安装rpm</h5> <blockquote><p>rpm -ivh ***.rpm</p> <p>其中i表示安装，v表示显示安装过程，h表示显示进度</p></blockquote> <h5 id="升级rpm包"><a href="#升级rpm包" aria-hidden="true" class="header-anchor">#</a> 升级rpm包</h5> <blockquote><p>rpm -Uvh ***.rpm</p></blockquote> <h5 id="删除软件包"><a href="#删除软件包" aria-hidden="true" class="header-anchor">#</a> 删除软件包</h5> <blockquote><p>rpm -e PACKAGE_NAME</p> <p>rpm -e -nodeps PACKAGE_NAME # 不考虑依赖包</p> <p>rpm -e -allmatches PACKAGE_NAME # 删除所有跟PACKAGE_NAME匹配的所有版本的包</p></blockquote> <h3 id="安装mysql-community-release-el7-5-noarch-rpm包"><a href="#安装mysql-community-release-el7-5-noarch-rpm包" aria-hidden="true" class="header-anchor">#</a> 安装mysql-community-release-el7-5.noarch.rpm包</h3> <blockquote><p>sudo rpm -ivh mysql-community-release-el7-5.noarch.rpm</p></blockquote> <p>安装这个包后，会获得两个mysql的yum repo源：/etc/yum.repos.d/mysql-community.repo，/etc/yum.repos.d/mysql-community-source.repo。</p> <h3 id="安装mysql-2"><a href="#安装mysql-2" aria-hidden="true" class="header-anchor">#</a> 安装mysql</h3> <blockquote><p>sudo yum install mysql-server</p></blockquote> <h4 id="如何查看mysql安装目录？"><a href="#如何查看mysql安装目录？" aria-hidden="true" class="header-anchor">#</a> 如何查看mysql安装目录？</h4> <p>方法一：通过rpm查看</p> <h5 id="查看软件是否安装"><a href="#查看软件是否安装" aria-hidden="true" class="header-anchor">#</a> 查看软件是否安装</h5> <blockquote><p>rpm -qa | grep mysql</p></blockquote> <p>根据rpm -ql 列出软件包安装的文件</p> <blockquote><p>rpm -ql mysql-community-client-5.6.39-2.el7.x86_64</p></blockquote> <h5 id="综合上述命令，可以直接使用以下命令查看存储位置"><a href="#综合上述命令，可以直接使用以下命令查看存储位置" aria-hidden="true" class="header-anchor">#</a> 综合上述命令，可以直接使用以下命令查看存储位置</h5> <blockquote><p>rpm -qal | grep mysql</p></blockquote> <p>方法二：</p> <p>which查找命令</p> <blockquote><p>which mysql</p></blockquote> <p>方法三：</p> <p>find命令查找</p> <blockquote><p>find / -name mysql</p></blockquote> <p>方法四：</p> <p>whereis命令 该命令和find类似</p> <blockquote><p>whereis mysql</p></blockquote> <p>注：whereis是通过本地架构好的数据库索引查找会比较快。如果没有更新到数据库里面的文件或命令则无法查找到信息</p> <h4 id="重置mysql密码"><a href="#重置mysql密码" aria-hidden="true" class="header-anchor">#</a> 重置mysql密码</h4> <blockquote><p>mysql -u root</p></blockquote> <p>登录时有可能报这样的错：ERROR 2002 (HY000): Can‘t connect to local MySQL server through socket ‘/var/lib/mysql/mysql.sock‘ (2)，原因是/var/lib/mysql的访问权限问题。下面的命令把/var/lib/mysql的拥有者改为当前用户：</p> <blockquote><p>sudo chown -R root:root /var/lib/mysql</p></blockquote> <h4 id="重启mysql服务"><a href="#重启mysql服务" aria-hidden="true" class="header-anchor">#</a> 重启mysql服务</h4> <blockquote><p>service mysqld restart</p></blockquote> <h4 id="登陆重置密码"><a href="#登陆重置密码" aria-hidden="true" class="header-anchor">#</a> 登陆重置密码</h4> <blockquote><p>mysql -u root  //直接回车进入mysql控制台
mysql &gt; use mysql;
mysql &gt; update user set password=password('123456') where user='root';
mysql &gt; exit;</p></blockquote> <h4 id="远程链接服务器mysql"><a href="#远程链接服务器mysql" aria-hidden="true" class="header-anchor">#</a> 远程链接服务器Mysql</h4> <h5 id="配置文件的修改"><a href="#配置文件的修改" aria-hidden="true" class="header-anchor">#</a> 配置文件的修改</h5> <h3 id="安装nginx"><a href="#安装nginx" aria-hidden="true" class="header-anchor">#</a> 安装nginx</h3> <h4 id="gcc安装"><a href="#gcc安装" aria-hidden="true" class="header-anchor">#</a> gcc安装</h4> <p>安装 nginx 需要先将官网下载的源码进行编译，编译依赖 gcc 环境，如果没有 gcc 环境，则需要安装：</p> <div class="language- extra-class"><pre class="language-text"><code>yum install gcc-c++
</code></pre></div><h4 id="pcre-pcre-devel安装"><a href="#pcre-pcre-devel安装" aria-hidden="true" class="header-anchor">#</a> PCRE pcre-devel安装</h4> <p>PCRE(Perl Compatible Regular Expressions) 是一个Perl库，包括 perl 兼容的正则表达式库。nginx 的 http 模块使用 pcre 来解析正则表达式，所以需要在 linux 上安装 pcre 库，pcre-devel 是使用 pcre 开发的一个二次开发库。nginx也需要此库。命令：</p> <div class="language- extra-class"><pre class="language-text"><code>yum install -y pcre pcre-devel
</code></pre></div><h4 id="zlib安装"><a href="#zlib安装" aria-hidden="true" class="header-anchor">#</a> zlib安装</h4> <p>zlib 库提供了很多种压缩和解压缩的方式， nginx 使用 zlib 对 http 包的内容进行 gzip ，所以需要在 Centos 上安装 zlib 库。</p> <div class="language- extra-class"><pre class="language-text"><code>yum install -y zlib zlib-devel
</code></pre></div><h4 id="openssl安装"><a href="#openssl安装" aria-hidden="true" class="header-anchor">#</a> OpenSSL安装</h4> <p>OpenSSL 是一个强大的安全套接字层密码库，囊括主要的密码算法、常用的密钥和证书封装管理功能及 SSL 协议，并提供丰富的应用程序供测试或其它目的使用。
nginx 不仅支持 http 协议，还支持 https（即在ssl协议上传输http），所以需要在 Centos 安装 OpenSSL 库。</p> <div class="language- extra-class"><pre class="language-text"><code>yum install -y openssl openssl-devel
</code></pre></div><h4 id="下载nginx"><a href="#下载nginx" aria-hidden="true" class="header-anchor">#</a> 下载nginx</h4> <blockquote><div class="language- extra-class"><pre class="language-text"><code>wget -c https://nginx.org/download/nginx-1.12.2.tar.gz
</code></pre></div></blockquote> <h4 id="解压nginx"><a href="#解压nginx" aria-hidden="true" class="header-anchor">#</a> 解压nginx</h4> <blockquote><div class="language- extra-class"><pre class="language-text"><code>tar -zxvf nginx-1.10.1.tar.gz
cd nginx-1.10.1
</code></pre></div></blockquote> <h4 id="配置"><a href="#配置" aria-hidden="true" class="header-anchor">#</a> 配置</h4> <p>使用默认配置</p> <blockquote><p>./configure</p></blockquote> <p><img src="http://reyshieh.com/assets/nginxconfig1.png" alt="nginx配置过程1"></p> <p><img src="http://reyshieh.com/assets/nginxconfig2.png" alt="nginx配置过程2"></p> <p>第二步</p> <blockquote><p>make</p></blockquote> <p><img src="http://reyshieh.com/assets/nginxinstallmake.png" alt="nginx安装make"></p> <p>第三步</p> <blockquote><p>make install</p></blockquote> <p><img src="http://reyshieh.com/assets/nginxinstallmake_install.png" alt="nginx安装make_install"></p> <p>第四步，检查安装路径</p> <blockquote><p>whereis nginx</p></blockquote> <p><img src="http://reyshieh.com/assets/nginxinstallcheck.png" alt="nginx安装检查"></p> <h4 id="启动、停止nginx"><a href="#启动、停止nginx" aria-hidden="true" class="header-anchor">#</a> 启动、停止nginx</h4> <div class="language- extra-class"><pre class="language-text"><code>cd /usr/local/nginx/sbin/
./nginx 
./nginx -s stop
./nginx -s quit
./nginx -s reload
</code></pre></div><blockquote><p><code>./nginx -s quit</code>:此方式停止步骤是待nginx进程处理任务完毕进行停止。
<code>./nginx -s stop</code>:此方式相当于先查出nginx进程id再使用kill命令强制杀掉进程。</p></blockquote> <p>查询nginx进程：</p> <div class="language- extra-class"><pre class="language-text"><code>ps aux|grep nginx
</code></pre></div><h4 id="重启nginx"><a href="#重启nginx" aria-hidden="true" class="header-anchor">#</a> 重启nginx</h4> <p>1.先停止再启动（推荐）：
对 nginx 进行重启相当于先停止再启动，即先执行停止命令再执行启动命令。如下：</p> <div class="language- extra-class"><pre class="language-text"><code>./nginx -s quit
./nginx
</code></pre></div><p>2.重新加载配置文件：
当 ngin x的配置文件 nginx.conf 修改后，要想让配置生效需要重启 nginx，使用<code>-s reload</code>不用先停止 ngin x再启动 nginx 即可将配置信息在 nginx 中生效，如下：
./nginx -s reload</p> <p>启动成功后，在浏览器可以看到这样的页面：</p> <h4 id="开机自启动"><a href="#开机自启动" aria-hidden="true" class="header-anchor">#</a> 开机自启动</h4> <p>即在<code>rc.local</code>增加启动代码就可以了。</p> <div class="language- extra-class"><pre class="language-text"><code>vi /etc/rc.local
</code></pre></div><p>增加一行 <code>/usr/local/nginx/sbin/nginx</code>
设置执行权限：</p> <div class="language- extra-class"><pre class="language-text"><code>chmod 755 rc.local
</code></pre></div><p><img src="http://reyshieh.com/assets/nginxautostart.png" alt="nginx开机自启动"></p> <h3 id="测试nginx启动时问题"><a href="#测试nginx启动时问题" aria-hidden="true" class="header-anchor">#</a> 测试nginx启动时问题</h3> <p>在服务器内用curl x.x.x.x 80是可以访问的</p> <p>在本机用telnet x.x.x.x 80不通，ping得通。</p> <p>于是查资料发现是阿里云的安全组规则没有对80端口开启安全策略</p> <p>开启后解决问题</p> <p><img src="http://reyshieh.com/assets/80portnotwork.png" alt="0端口访问一直不"></p> <h3 id="https配置"><a href="#https配置" aria-hidden="true" class="header-anchor">#</a> https配置</h3> <h4 id="安装mod-ssl"><a href="#安装mod-ssl" aria-hidden="true" class="header-anchor">#</a> 安装mod_ssl</h4> <p>通过yum安装mod_ssl</p> <blockquote><p>yum -y install mod_ssl</p></blockquote> <h4 id="http服务器上配置mod-ssl"><a href="#http服务器上配置mod-ssl" aria-hidden="true" class="header-anchor">#</a> http服务器上配置mod_ssl</h4> <p>第一步 建立服务器秘钥：</p> <p><img src="http://reyshieh.com/assets/httpconfmod_ssl.png" alt="http服务器上配置mod_ssl"></p> <div class="language- extra-class"><pre class="language-text"><code>[root@test ~]#  cd /etc/pki/tls/certs/　 ← 进入HTTP服务器配置文件所在目录
[root@test certs]#  make server.key　 ← 建立服务器密钥
umask 77 ; \
               /usr/bin/openssl genrsa -des3 1024 &gt; server.key
Generating RSA private key, 1024 bit long modulus
................++++++
......++++++
e is 65537 (0x10001)
Enter pass phrase:　                     ← ![http服务器上配置mod_ssl-删除秘钥中的密码](D:\comtop\repo\simplerepo\玩服务器遇到的问题\http服务器上配置mod_ssl-删除秘钥中的密码.png)在这里输入口令
Verifying - Enter pass phrase:　  ← 确认口令，再次输入
</code></pre></div><p><img src="http://reyshieh.com/assets/httpconfmod_ssl-delete.png" alt="http服务器上配置mod_ssl-删除秘钥中的密码"></p> <div class="language- extra-class"><pre class="language-text"><code>[root@test certs]#  openssl rsa -in server.key -out server.key　 ← 从密钥中删除密码（以避免系统启动后被询问口令）
Enter pass phrase for server.key:　 ← 输入口令
writing RSA key
</code></pre></div><p>第二步 建立服务器公钥</p> <p><img src="http://reyshieh.com/assets/httpconfigpublickey.png" alt="http服务器上配置公钥"></p> <div class="language- extra-class"><pre class="language-text"><code>[root@test certs]#  make server.csr　 ← 建立服务器密钥
umask 77 ; \
                /usr/bin/openssl req -utf8 -new -key server.key -out server.csr
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [GB]:CN　 ← 输入国名
State or Province Name (full name) [Berkshire]:Fujian　 ← 输入省名
Locality Name (eg, city) [Newbury]:Longyan　 ← 输入城市名
Organization Name (eg, company) [My Company Ltd]:www.coracain.top　 ← 输入组织名（任意）
Organizational Unit Name (eg, section) []:　 ← 不输入，直接回车
Common Name (eg, your name or your server's hostname) []:www.coracain.top　 ← 输入通称（任意）
Email Address []:m15960192140@163.com 　 ← 输入电子邮箱地址 
Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:　 ← 不输入，直接回车
An optional company name []: 　 ← 不输入，直接回车
</code></pre></div><p>第三步 建立服务器证书</p> <p><img src="http://reyshieh.com/assets/httpsetupcert.png" alt="http服务器上建立服务器证书"></p> <div class="language- extra-class"><pre class="language-text"><code>[root@test certs]#  openssl x509 -in server.csr -out server.pem -req -signkey server.key -days 365　 ← 建立服务器证书
Signature ok
subject=/C=CN/ST=Fujian/L=Longyan/O=www.coracain.top/CN=www.coracain.top/emailAddress=m15960192140@163.com
Getting Private key
[root@test certs]#  chmod 400 server.*    ← 修改权限为400
</code></pre></div><p>第四步 设置SSL</p> <div class="language- extra-class"><pre class="language-text"><code>[root@test certs]#  vi /etc/httpd/conf.d/ssl.conf　 ← 修改SSL的设置文件
#DocumentRoot &quot;/var/www/html&quot;　 ← 找到这一行，将行首的“#”去掉
　↓
DocumentRoot &quot;/var/www/html&quot;　 ← 变为此状态
</code></pre></div><p>第五步 重新启动HTTP服务，让SSL生效</p> <p>以上创建的https是不安全的，白白研究。。。</p> <p><strong>注</strong> make命令解析</p> <div class="language- extra-class"><pre class="language-text"><code>make命令本身可带有四个参数：标志、宏定义、描述文件名和目标文件名。其标准形式为：
make [flags] [macro definitions] [targets]

Unix系统 标志位flags选项及其含义：
-f file　 指定file文件为描述文件，如果file参数为&quot;-&quot;符，那么描述文件指向标准输入。如果没有&quot;-f&quot;参数，则系统将默认当前目录下名为 makefile或者名为Makefile的文件为描述文件。在Linux中， GNU make 工具在当前工作目录中按照GNUmakefile、makefile、Makefile的顺序搜索 makefile文件。
-i 　　忽略命令执行返回的出错信息。 
-s 　　沉默模式，在执行之前不输出相应的命令行信息。 
-r 　　禁止使用build-in规则。 
-n 　　非执行模式，输出所有执行命令，但并不执行。 
-t 　　更新目标文件。 
-q　　 make操作将根据目标文件是否已经更新返回&quot;0&quot;或非&quot;0&quot;的状态信息。 
-p　　 输出所有宏定义和目标文件描述。 
-d　　 Debug模式，输出有关文件和检测时间的详细信息。

例如，要做出文件a.txt，就可以执行下面的命令
make a.txt
但是，如果你真的输入这条命令，它并不会起作用。因为Make命令本身并不知道，如何做出a.txt，需要有人告诉它，如何调用其他命令完成这个目标
比如，假设文件 a.txt 依赖于 b.txt 和 c.txt ，是后面两个文件连接（cat命令）的产物。那么，make 需要知道下面的规则
a.txt: b.txt c.txt
cat b.txt c.txt &gt; a.txt
也就是说，make a.txt 这条命令的背后，实际上分成两步：第一步，确认 b.txt 和 c.txt 必须已经存在，第二步使用 cat 命令 将这个两个文件合并，输出为新文件。
像这样的规则，都写在一个叫做Makefile的文件中，Make命令依赖这个文件进行构建。Makefile文件也可以写为makefile， 或者用命令行参数指定为其他文件名。
$ make -f rules.txt
# 或者
$ make --file=rules.txt
上面代码指定make命令依据rules.txt文件中的规则，进行构建。

linux系统 稍有不同，以下只列出不同部分：
-c dir　　 在读取 makefile 之前改变到指定的目录dir。 
-I dir 　　当包含其他 makefile文件时，利用该选项指定搜索目录。 
-h 　　help文挡，显示所有的make选项。 
-w 　　在处理 makefile 之前和之后，都显示工作目录。

通过命令行参数中的target ，可指定make要编译的目标，并且允许同时定义编译多个目标，操作时按照从左向右的顺序依次编译target选项中指定的目标文件。如果命令行中没有指 定目标，则系统默认target指向描述文件中第一个目标文件。

1、makefile 

makefile定义了一系列的规则来指定，哪些文件需要先编译，哪些文件需要后编译，哪些文件需要重新编译，甚至于进行更复杂的功能操作，因为 makefile就像一个Shell脚本一样，其中也可以执行操作系统的命令。makefile带来的好处就是--“自动化编译”,一旦写好，只需要一个make命令，整个工程完全自动编译，极大的提高了软件开发的效率。
每条规则的形式如下:
&lt;target&gt; : &lt;prerequisites&gt; 
[tab] &lt;commands&gt;
上面第一行冒号前面的部分，叫做&quot;目标&quot;（target），冒号后面的部分叫做&quot;前置条件&quot;（prerequisites）；第二行必须由一个tab键起首，后面跟着&quot;命令&quot;（commands）。
&quot;目标&quot;是必需的，不可省略；&quot;前置条件&quot;和&quot;命令&quot;都是可选的，但是两者之中必须至少存在一个。
1.1 目标（target）
一个目标（target）就构成一条规则。目标通常是文件名，指明Make命令所要构建的对象，比如上文的 a.txt 。目标可以是一个文件名，也可以是多个文件名，之间用空格分隔。
除了文件名，目标还可以是某个操作的名字，这称为&quot;伪目标&quot;（phony target）。
clean:
rm *.o
上面代码的目标是clean，它不是文件名，而是一个操作的名字，属于&quot;伪目标 &quot;，作用是删除对象文件。
$ make clean
但是，如果当前目录中，正好有一个文件叫做clean，那么这个命令不会执行。因为Make发现clean文件已经存在，就认为没有必要重新构建了，就不会执行指定的rm命令。
为了避免这种情况，可以明确声明clean是&quot;伪目标&quot;，写法如下。
.PHONY: clean
clean:
rm *.o temp
声明clean是&quot;伪目标&quot;之后，make就不会去检查是否存在一个叫做clean的文件，而是每次运行都执行对应的命令。像.PHONY这样的内置目标名还有不少，可以查看手册。
如果Make命令运行时没有指定目标，默认会执行Makefile文件的第一个目标。
$ make
上面代码执行Makefile文件的第一个目标
2.2 前置条件（prerequisites）
前置条件通常是一组文件名，之间用空格分隔。它指定了&quot;目标&quot;是否重新构建的判断标准：只要有一个前置文件不存在，或者有过更新（前置文件的last-modification时间戳比目标的时间戳新），&quot;目标&quot;就需要重新构建。

2、make命令
make --根据makefile文件编译源代码、链接、生成目标文件、可执行文件
make clean --清除上次的make命令所产生的object文件（后缀为&quot;.o&quot;的文件）及可执行文件
make install -- 将编译成功的可执行文件安装到系统目录中，一般为/usr/local/bin目录
make dist --产生发布软件包文件（即distribution package） 这个命令将会将可执行文件及相关文件打包还曾一个tar.gz压缩的文件用来作为发布软件的软件包。它会在当前目录下生成一个名字类似“PACKAGE-VERSION.tar.gz”的文件。PACKAGE和VERSION,是我们在configure.in中定义的AM_INIT_AUTOMAKE（PACKAGE, VERSION）。 
make distcheck --生成发布软件包并对其进行测试检查，以确定发布包的正确性。这个操作将自动把压缩包文件解开，然后执行configure命令，并且执行make,来确认编译不出现错误，最后提示你软件包已经准备好，可以发布了
make distclean --类似make clean,但同时也将configure生成的文件全部删除掉，包括Makefile文件
</code></pre></div><h3 id="certbot-免费安全证书"><a href="#certbot-免费安全证书" aria-hidden="true" class="header-anchor">#</a> certbot 免费安全证书</h3> <h4 id="安装certbot"><a href="#安装certbot" aria-hidden="true" class="header-anchor">#</a> 安装CertBot</h4> <div class="language- extra-class"><pre class="language-text"><code>sudo yum install epel-release
sudo yum install certbot
</code></pre></div><h4 id="配置nginx"><a href="#配置nginx" aria-hidden="true" class="header-anchor">#</a> 配置nginx</h4> <p>使用webroot配置模式</p> <p>因为，CertBot在验证服务器域名的时候，会生成一个随机文件，然后CertBot的服务器会通过HTTP访问你的这个文件，因此要确保你的Nginx配置好，以便可以访问到这个文件。</p> <p>修改你的服务器配置，在<code>server模块</code>添加：</p> <div class="language- extra-class"><pre class="language-text"><code>location ^~ /.well-known/acme-challenge/ {
   default_type &quot;text/plain&quot;;
   root     /usr/share/nginx/html;
}

location = /.well-known/acme-challenge/ {
   return 404;
}
</code></pre></div><p>接下来执行：</p> <div class="language- extra-class"><pre class="language-text"><code>sudo certbot certonly --webroot -w /usr/local/nginx/html/ -d coracain.top
</code></pre></div><p>但是报了</p> <div class="language- extra-class"><pre class="language-text"><code>ImportError: 'pyOpenSSL' module missing required functionality. Try upgrading to v0.14 or newer. 
</code></pre></div><p>以下是解决思路</p> <p>https://github.com/certbot/certbot/issues/5534</p> <p>try <code>pip install --upgrade --force-reinstall 'requests==2.6.0'</code></p> <p>又报了一个错误。。</p> <p><img src="http://reyshieh.com/assets/cerboterror1.png" alt="cerbot报错1"></p> <p>解决办法</p> <p><img src="http://reyshieh.com/assets/cerboterror1-solve.png" alt="cerbot报错1-解决方案"></p> <p>增加一个只对主域名做解析的dns配置</p> <p>接下来成功了</p> <p><img src="http://reyshieh.com/assets/cerbot-success.png" alt="cerbot 成功"></p> <p>但在启动nginx时又报了异常</p> <p><img src="http://reyshieh.com/assets/httpsnginxconfigerror.png" alt="https nginx 配置报错"></p> <p><img src="http://reyshieh.com/assets/httpsnginxconfigerror-catch.png" alt="https nginx 配置报错-异常信息"></p> <p>原因是：nginx缺少http_ssl_module模块，编译安装的时候带上--with-http_ssl_module配置就行了，但是现在的情况是nginx已经安装，需要添加模块</p> <p><strong>注</strong> nginx的安装目录是/usr/local/nginx</p> <pre><code>源码包在/home/cain/nginx-1.12.2
</code></pre> <p><img src="http://reyshieh.com/assets/solvenginxnotsupporthttps.png" alt="解决安装的nginx不支持https的问题"></p> <p>切换到源码包</p> <blockquote><p>cd /home/cain/nginx-1.12.2</p></blockquote> <p>查看nginx原有的模块</p> <blockquote><p>/usr/local/nginx/sbin/nginx -V</p></blockquote> <p>在configure arguments:后面显示的原有的configure参数如下：</p> <blockquote><p>--prefix=/usr/local/nginx --with-http_stub_status_module</p></blockquote> <p>那么我们的新配置信息就应该这样写：</p> <blockquote><p>[root@coracain nginx-1.12.2]#  ./configure --prefix=/usr/local/nginx/ --with-http_stub_status_module --with-http_ssl_module</p></blockquote> <p>运行上面的命令即可，等配置完</p> <p>配置完成后，运行命令</p> <blockquote><p>make</p></blockquote> <p>这里不要进行make install，否则就是覆盖安装</p> <p><img src="http://reyshieh.com/assets/solvenginxnotsupporthttps-process.png" alt="解决安装的nginx不支持https的问题-过程"></p> <p>然后备份原有已安装好的nginx</p> <blockquote><p>cp /usr/local/nginx/sbin/nginx /usr/local/nginx/sbin/nginx.bak</p></blockquote> <p>然后将刚刚编译好的nginx覆盖掉原有的nginx（这个时候nginx要停止状态）</p> <blockquote><p>/usr/local/nginx/sbin/nginx -s quit</p> <p>[root@coracain nginx-1.12.2]# cp ./objs/nginx /usr/local/nginx/sbin/</p></blockquote> <p>然后启动nginx，仍可以通过命令查看是否已经加入成功</p> <blockquote><p>/usr/local/nginx/sbin/nginx -V</p></blockquote> <h4 id="certbot证书更新"><a href="#certbot证书更新" aria-hidden="true" class="header-anchor">#</a> certbot证书更新</h4> <p>由于certbot所使用的letsencrypt证书只有90天的有效期，所以我们需要对它定期自动更新。</p> <p>首先模拟更新：</p> <div class="language- extra-class"><pre class="language-text"><code>sudo certbot renew --dry-run

# 看到如下输出证明模拟更新成功
-------------------------------------------------------------------------------
Processing /etc/letsencrypt/renewal/your.domain.com.conf
-------------------------------------------------------------------------------
** DRY RUN: simulating 'certbot renew' close to cert expiry
**          (The test certificates below have not been saved.)

Congratulations, all renewals succeeded. The following certs have been renewed:
  /etc/letsencrypt/live/xxxx.com/fullchain.pem (success)
** DRY RUN: simulating 'certbot renew' close to cert expiry
**          (The test certificates above have not been saved.)
</code></pre></div><p>然后就可以使用<code>crontab -e</code>命令来实现自动化了：</p> <div class="language- extra-class"><pre class="language-text"><code>sudo crontab -e

#添加配置，每周一半夜3点00分执行renew：

00 3 * * 1 /usr/bin/certbot renew  &gt;&gt; /var/log/le-renew.log
</code></pre></div><p><a href></a></p> <h2 id="nginx添加http-2支持"><a href="#nginx添加http-2支持" aria-hidden="true" class="header-anchor">#</a> nginx添加http/2支持</h2> <p>参照以上添加https http_ssl_module模块方式，添加http_v2_module模块，由于该模块同时需要ssl的支持，如果在没有添加http_ssl_module模块，要一并添加。</p> <p>在./configure中加入: —with-http_v2_module，注意—with-http_ssl_module也要有</p> <p><strong>但是按照添加了http_v2_module后，还是没能升级成http2</strong></p> <p>原因是OpenSSL 1.0.1e版本不支持ALPN，无法开启HTTP2，因此需要升级OpenSSL</p> <div class="language- extra-class"><pre class="language-text"><code>wget --no-check-certificate https://www.openssl.org/source/openssl-1.0.2j.tar.gz
tar zxvf openssl-1.0.2j.tar.gz
cd openssl-1.0.2j
./config shared zlib
make &amp;&amp; make install
mv /usr/bin/openssl /usr/bin/openssl.old
mv /usr/include/openssl /usr/include/openssl.old
ln -s /usr/local/ssl/bin/openssl /usr/bin/openssl
ln -s /usr/local/ssl/include/openssl /usr/include/openssl
echo &quot;/usr/local/ssl/lib&quot; &gt;&gt; /etc/ld.so.conf
ldconfig -v
</code></pre></div><p>以上操作完后，查看openssl版本</p> <div class="language- extra-class"><pre class="language-text"><code>openssl version
</code></pre></div><p>然后和上面重新编译nginx的步骤相同处理，就可以支持h2了</p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/knowledge-note/knowledge/Damn-hole-of-blink.html" class="prev">
          Blink
        </a></span> <!----></p></div> </div> <!----></div></div>
    <script src="/knowledge-note/assets/js/app.5911ee68.js" defer></script><script src="/knowledge-note/assets/js/39.503b146a.js" defer></script>
  </body>
</html>
