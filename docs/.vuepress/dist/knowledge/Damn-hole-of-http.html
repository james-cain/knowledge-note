<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>http/http2/https | Jamescain Blog</title>
    <meta name="description" content="A knowledge blog">
    <link rel="icon" href="/knowledge-note/favicon.ico">
    
    <link rel="preload" href="/knowledge-note/assets/css/0.styles.44e21d02.css" as="style"><link rel="preload" href="/knowledge-note/assets/js/app.a571e02f.js" as="script"><link rel="preload" href="/knowledge-note/assets/js/17.2b5e8c6e.js" as="script"><link rel="prefetch" href="/knowledge-note/assets/js/19.c37ef0c0.js"><link rel="prefetch" href="/knowledge-note/assets/js/2.cda51ec0.js"><link rel="prefetch" href="/knowledge-note/assets/js/3.6caa4f71.js"><link rel="prefetch" href="/knowledge-note/assets/js/4.81837870.js"><link rel="prefetch" href="/knowledge-note/assets/js/5.4abe3e4f.js"><link rel="prefetch" href="/knowledge-note/assets/js/6.a10385b4.js"><link rel="prefetch" href="/knowledge-note/assets/js/7.a491225e.js"><link rel="prefetch" href="/knowledge-note/assets/js/8.f2980765.js"><link rel="prefetch" href="/knowledge-note/assets/js/9.ce76167c.js"><link rel="prefetch" href="/knowledge-note/assets/js/10.9fb009fc.js"><link rel="prefetch" href="/knowledge-note/assets/js/11.bc65059e.js"><link rel="prefetch" href="/knowledge-note/assets/js/12.669a327f.js"><link rel="prefetch" href="/knowledge-note/assets/js/13.0bdf7f86.js"><link rel="prefetch" href="/knowledge-note/assets/js/14.a9b555b9.js"><link rel="prefetch" href="/knowledge-note/assets/js/15.2b1887a3.js"><link rel="prefetch" href="/knowledge-note/assets/js/16.44d5feba.js"><link rel="prefetch" href="/knowledge-note/assets/js/18.6f16dec0.js"><link rel="prefetch" href="/knowledge-note/assets/js/20.2a764e2b.js"><link rel="prefetch" href="/knowledge-note/assets/js/21.e5945440.js"><link rel="prefetch" href="/knowledge-note/assets/js/22.89cbd53a.js"><link rel="prefetch" href="/knowledge-note/assets/js/23.083f87bd.js"><link rel="prefetch" href="/knowledge-note/assets/js/24.d6db099f.js"><link rel="prefetch" href="/knowledge-note/assets/js/25.305e737e.js"><link rel="prefetch" href="/knowledge-note/assets/js/26.32f2986f.js"><link rel="prefetch" href="/knowledge-note/assets/js/27.75103a1d.js"><link rel="prefetch" href="/knowledge-note/assets/js/28.e322ff7c.js"><link rel="prefetch" href="/knowledge-note/assets/js/29.57b07e92.js"><link rel="prefetch" href="/knowledge-note/assets/js/30.edb680ca.js"><link rel="prefetch" href="/knowledge-note/assets/js/31.9d28451c.js"><link rel="prefetch" href="/knowledge-note/assets/js/32.145cb0e7.js"><link rel="prefetch" href="/knowledge-note/assets/js/33.1c00a16b.js"><link rel="prefetch" href="/knowledge-note/assets/js/34.1628add9.js"><link rel="prefetch" href="/knowledge-note/assets/js/35.d2c17cf5.js"><link rel="prefetch" href="/knowledge-note/assets/js/36.92610b6b.js"><link rel="prefetch" href="/knowledge-note/assets/js/37.4a523ed6.js"><link rel="prefetch" href="/knowledge-note/assets/js/38.4b9f3dd3.js"><link rel="prefetch" href="/knowledge-note/assets/js/39.dac86e16.js">
    <link rel="stylesheet" href="/knowledge-note/assets/css/0.styles.44e21d02.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/knowledge-note/" class="home-link router-link-active"><!----> <span class="site-name">Jamescain Blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/knowledge-note/knowledge/" class="nav-link router-link-active">知识库</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://twitter.com/Jamescain_lll" target="_blank" rel="noopener noreferrer" class="nav-link external">
  作者twitter
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/james-cain/My-lab" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/knowledge-note/knowledge/" class="nav-link router-link-active">知识库</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://twitter.com/Jamescain_lll" target="_blank" rel="noopener noreferrer" class="nav-link external">
  作者twitter
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/james-cain/My-lab" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>基础</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/knowledge-note/knowledge/Damn-hole-of-html5.html" class="sidebar-link">html5</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-CSS3.html" class="sidebar-link">CSS3</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-javascript.html" class="sidebar-link">JavaScript</a></li><li><a href="/knowledge-note/knowledge/review-the-javascript.html" class="sidebar-link">ES6</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-interview.html" class="sidebar-link">Interview</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-design-patterns.html" class="sidebar-link">设计模式</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-http.html" class="active sidebar-link">http/http2/https</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/Damn-hole-of-http.html#http" class="sidebar-link">HTTP</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/Damn-hole-of-http.html#spdy-http2-0" class="sidebar-link">SPDY/HTTP2.0</a></li></ul></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>进阶</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/knowledge-note/knowledge/Damn-hole-of-common-plugin.html" class="sidebar-link">常用插件包问题</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-webapi.html" class="sidebar-link">WebAPI</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-Browser.html" class="sidebar-link">Browser</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-IE9.html" class="sidebar-link">IE9 兼容性</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-nodejs.html" class="sidebar-link">nodejs</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-mobile-compatibility.html" class="sidebar-link">mobile 兼容性</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-google-devtools.html" class="sidebar-link">google devtools</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-network.html" class="sidebar-link">网络</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-safe-and-hacker.html" class="sidebar-link">网络安全</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-javascript-algonithms.html" class="sidebar-link">JavaScript算法</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-performance.html" class="sidebar-link">性能优化</a></li><li><a href="/knowledge-note/knowledge/parameters-of-package.html" class="sidebar-link">详解package.json</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>工具</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/knowledge-note/knowledge/Damn-hole-of-babel.html" class="sidebar-link">babel7</a></li><li><a href="/knowledge-note/knowledge/webpack-perf.html" class="sidebar-link">Webpack打包优化</a></li><li><a href="/knowledge-note/knowledge/webpack-source-learning.html" class="sidebar-link">webpack源码</a></li><li><a href="/knowledge-note/knowledge/how-to-use-npm-sonatype.html" class="sidebar-link">用sonatype3搭建npm私服</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>拓展</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/knowledge-note/knowledge/Damn-hole-of-pwa.html" class="sidebar-link">PWA</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>源码分析</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/knowledge-note/knowledge/Damn-hole-of-mvvm.html" class="sidebar-link">MVVM</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-React.html" class="sidebar-link">React</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-Vue.html" class="sidebar-link">Vue</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>其他</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/knowledge-note/knowledge/server-record.html" class="sidebar-link">部署一台属于自己的服务器</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="http-http2-https"><a href="#http-http2-https" aria-hidden="true" class="header-anchor">#</a> http/http2/https</h1> <h2 id="http"><a href="#http" aria-hidden="true" class="header-anchor">#</a> HTTP</h2> <h3 id="headers"><a href="#headers" aria-hidden="true" class="header-anchor">#</a> headers</h3> <h4 id="请求头"><a href="#请求头" aria-hidden="true" class="header-anchor">#</a> 请求头</h4> <ol><li><u>Accept</u>：用来告知客户端可以处理的内容类型，这种内容类型用MIME类型来表示。借助内容协商机制，服务器可以从诸多备选项中选择一项进行应用，并使用<strong>Content-Type</strong>应答头通知客户端它的选择。</li></ol> <p>&lt; MIME_type &gt;/&lt; MIME_subtype &gt;</p> <p>&lt; MIME_type &gt;/*</p> <p>*/ * 任意类型的MIME类型</p> <p>;q=(q因子权重)</p> <p>如： text/html,application/xhtml+xml,application/xml;q=0.9, * /*;q=0.8</p> <ol start="2"><li><u>Accept-Charset</u>：请求头用来告知（服务器）客户端可以处理的字符集类型。借助内容协商机制，服务器可以从诸多备选项中选择一项进行应用，并使用<strong>Content-Type</strong>应答头通知客户端它的选择。通常不会设置此项。</li></ol> <p>&lt;<strong>charset</strong>&gt; utf-8或iso-8895-1字符集</p> <p>*** 通配符**</p> <p>;q=</p> <ol start="3"><li><u>Accept-Encoding</u>：将客户端能够理解的内容编码方式进行通知。使用并在相应报文首部<strong>Content-Encoding</strong>中通知客户端选择</li></ol> <p>压缩方式包括gzip（Lempel-Ziv coding压缩算法（LZ77）+32位CRC校验的编码方式）、compress（Lempel-Ziv-Welch（LZW））、deflate（zlib结构+deflate压缩算法）、br（Brotli算法）、identity（保持自身）、*（匹配其他任意未在首部字段中列出的编码方式）</p> <p>identity不压缩存在两种情形：a.要发送的数据已经经过压缩，再次进行压缩不会导致被传输的数据量更小，如图像格式 b.服务器超载，无法承受压缩需求导致的计算开销，通常，如果服务器使用超过80%的计算能力，不建议压缩</p> <ol start="4"><li><p>Accept-Language：允许客户端声明它可以理解的自然语言，以及优先选择的区域方言，并使用<strong>Content-Language</strong>应答头通知客户端它的选择。</p></li> <li><p>Accept-Ranges：标识自身支持范围请求（partial requests）。当浏览器发现Accept-Range头时，可以尝试继续中断了的下载，而不是重新开始</p></li></ol> <p>none：在一些浏览器，如IE9，会依据该头部去禁用或者移除下载管理器的暂停按钮</p> <p>bytes</p> <ol start="6"><li>Access-Control-Allow-Credentials：表示是否可以将对请求的响应暴露给页面。Credentials可以是<u>cookies，authorization headers 或TLS client certificates</u></li></ol> <p>当作为对预检请求的响应的一部分时，这能表示是否真正的请求可以使用credentials。注意GET请求<strong>没有预检</strong>，所以若对资源的请求带有了credentials，响应会被浏览器忽视</p> <p>Access-Control-Allow-Credentials头需与XMLHttpRequest.withCredentials或Fetch api中的Request()构造器中的credentials选项结合使用</p> <p>Access-Control-Allow-Credentials: true</p> <p>使用带credentials的XHR：</p> <div class="language- extra-class"><pre class="language-text"><code>var xhr = new XMLHttpRequest();
xhr.open('GET', 'http://example.com/', true);
xhr.withCredentials = true;
xhr.send(null);
</code></pre></div><p>使用带credentials的Fetch：</p> <div class="language- extra-class"><pre class="language-text"><code>fetch(url, {
    credentials: 'include'
})
</code></pre></div><ol start="7"><li>Access-Control-Allow-Headers：用于<strong>预检请求</strong>中，列出将会在正式请求的<strong>Access-Control-Expose-Headers</strong>字段中出现的首部信息</li></ol> <p>简单首部，如 <a href="https://developer.mozilla.org/en-US/docs/Glossary/simple_header" target="_blank" rel="noopener noreferrer">simple headers<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Accept" target="_blank" rel="noopener noreferrer"><code>Accept</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Accept-Language" target="_blank" rel="noopener noreferrer"><code>Accept-Language</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Language" target="_blank" rel="noopener noreferrer"><code>Content-Language</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Type" target="_blank" rel="noopener noreferrer"><code>Content-Type</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> （只限于解析后的值为 <code>application/x-www-form-urlencoded、``multipart/form-data</code>或 <code>text/plain 三种MIME类型（不包括参数）），它们始终是被支持的，不需要在这个首部特意列出。</code></p> <p>如果请求中含有 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Request-Headers" target="_blank" rel="noopener noreferrer"><code>Access-Control-Request-Headers</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 字段，那么这个首部是必要的。</p> <ol start="8"><li>Access-Control-Allow-Methods：对<strong>预检请求</strong>的应答明确了客户端所要访问的资源允许使用的方法或方法列表</li></ol> <p>Access-Control-Allow-Methods: POST,GET,OPTIONS</p> <ol start="9"><li>Access-Control-Allow-Origin：指定了该响应的资源是否允许与给定的origin共享</li></ol> <p>***** 允许所有域都具有访问资源的权限</p> <p>&lt;<strong>origin</strong>&gt; 指定一个可以访问资源的URI</p> <ol start="10"><li>Access-Control-Expose-Headers：列出哪些首部可以作为响应的一部分暴露给外部</li></ol> <p>默认情况下，Cache-Control、Content-Language、Content-Type、Expires、Last-Modified、Pragma简单响应首部是可以暴露给外部的，其他的首部需要在里面列出来</p> <ol start="11"><li>Access-Control-Max-Age：表示<strong>预检请求</strong>的返回结果（即Access-Control-Allow-Methods和Access-Control-Allow-Headers提供的信息）可以被缓存多久</li></ol> <p>在Firefox中，上限是24小时（即87400秒），在Chromium中则是10分钟（即600秒）还规定了默认值是5秒</p> <p>若值为-1，表示禁用缓存。每一次请求都需要提供预检请求，即用OPTIONS请求进行预检</p> <ol start="12"><li><p>Access-Control-Request-Headers：出现在<strong>预检请求</strong>中，用于通知服务器在真正的请求中会采用哪些请求首部</p></li> <li><p>Access-Control-Request-Method：出现在<strong>预检请求</strong>中，用于通知服务器在真正的请求中会采用哪种HTTP方法。因为预检请求所使用的方法总是OPTIONS，与实际请求所使用的方法不一样，<strong>所以这个首部是必要的</strong></p></li> <li><p>Age：消息头里包含消息对象在缓存代理中存储的时长，以秒为单位</p></li></ol> <p>Age消息头的值通常接近于0.表示此消息对象刚刚从原始服务器获取不久；其他的值表示代理服务器当前的系统时间与此应答消息中的通用<strong>消息头Date</strong>的值之差</p> <ol start="15"><li>Allow：用于枚举资源所支持的HTTP方法的集合</li></ol> <p>若服务器返回状态码 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/405" target="_blank" rel="noopener noreferrer"><code>405</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <code>Method Not Allowed，则该首部字段亦需要同时返回给客户端。如果</code> <code>Allow</code>  首部字段的值为空，说明资源不接受使用任何 HTTP 方法的请求。这是可能的，比如服务器需要临时禁止对资源的任何访问。</p> <ol start="16"><li><p>Authorization：请求消息头含有服务器用于验证用户代理身份的凭证，通常会在服务器返回<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/401" target="_blank" rel="noopener noreferrer"><code>401</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <code>Unauthorized</code> 状态码以及<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/WWW-Authenticate" target="_blank" rel="noopener noreferrer"><code>WWW-Authenticate</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 消息头之后在后续请求中发送此消息头。</p></li> <li><p>Cache-Control：用于http请求和响应中通过指定指令来实现缓存机制。缓存指令是单向的，意味着在请求设置的指令，在响应中不一定包含相同的指令。</p></li></ol> <ul><li><p>缓存请求指令</p> <div class="language- extra-class"><pre class="language-text"><code>Cache-Control: max-age=&lt;seconds&gt;(最大存储周期，相对于请求的时间)
Cache-Control: max-stale[=&lt;seconds&gt;](表明客户端愿意接收一个已经过期的资源。 可选的设置一个时间(单位秒)，表示响应不能超过的过时时间)
Cache-Control: min-fresh=&lt;seconds&gt;(表示客户端希望在指定的时间内获取最新的响应)
Cache-control: no-cache 
Cache-control: no-store
Cache-control: no-transform
Cache-control: only-if-cached(表明客户端只接受已缓存的响应，并且不要向原始服务器检查是否有更新的拷贝)
</code></pre></div></li> <li><p>缓存响应指令</p> <div class="language- extra-class"><pre class="language-text"><code>Cache-control: must-revalidate(缓存必须在使用之前验证旧资源的状态，并且不可使用过期资源)
Cache-control: no-cache(在释放缓存副本之前，强制告诉缓存将请求提交给原始服务器进行验证)
Cache-control: no-store(缓存不应存储有关客户端请求或服务器响应的任何内容)
Cache-control: no-transform(不得对资源进行转换或转变)
Cache-control: public(可缓存，表明响应可以被任何对象缓存)
Cache-control: private(可缓存，表明响应只能被单个用户缓存，不能作为共享缓存，即代理服务器不能缓存)
Cache-control: proxy-revalidate(与must-revalidate作用相同，但它仅适用于共享缓存（例如代理），并被私有缓存忽略)
Cache-Control: max-age=&lt;seconds&gt;
Cache-control: s-maxage=&lt;seconds&gt;(覆盖max-age 或者 Expires 头，但是仅适用于共享缓存(比如各个代理)，并且私有缓存中它被忽略。)
</code></pre></div></li> <li><p>拓展Cache-Control指令</p> <div class="language- extra-class"><pre class="language-text"><code>Cache-control: immutable (表示响应正文不会随时间而改变)
Cache-control: stale-while-revalidate=&lt;seconds&gt;(表明客户端愿意接受陈旧的响应，同时在后台异步检查新的响应。秒值指示客户愿意接受陈旧响应的时间长度)
Cache-control: stale-if-error=&lt;seconds&gt;(表示如果新的检查失败，则客户愿意接受陈旧的响应。秒数值表示客户在初始到期后愿意接受陈旧响应的时间)
</code></pre></div></li></ul> <p>禁止缓存</p> <div class="language- extra-class"><pre class="language-text"><code>Cache-Control: no-cache, no-store, must-revalidate
</code></pre></div><p>缓存静态资源</p> <div class="language- extra-class"><pre class="language-text"><code>Cache-Control: public, max-age=31536000
</code></pre></div><ol start="18"><li>Clear-Site-Data：表示清除当前请求网站有关的浏览器数据（cookie，存储，缓存）。若想清楚所有类型的数据，可以使用通配符（*）</li></ol> <div class="language- extra-class"><pre class="language-text"><code>// 单个参数
Clear-Site-Data: &quot;cache&quot;
// 多个参数(用逗号分隔)
Clear-Site-Data: &quot;cache&quot;, &quot;cookies&quot;
</code></pre></div><p>参数：</p> <ul><li>&quot;cache&quot; 服务端希望删除本URL原始响应的本地缓存数据。根据浏览器不同，可能还会清除预渲染页面，脚本缓存，WebGL着色器缓存或者地址栏建议等内容</li> <li>&quot;cookies&quot;服务端希望删除URL响应的所有cookie。HTTP身份验证凭据也会被清除</li> <li>&quot;storage&quot;服务端希望删除URL原响应的所有DOM存储，包括存储机制，如localStorage、sessionStorage、IndexedDB、服务注册线程、AppCache、WebSQL数据库、FileSystem API data、Plugin data</li> <li>&quot;executionContexts&quot; 服务端希望浏览器重新加载本请求（location.reload）</li> <li>&quot;*&quot; 服务端希望清除原请求响应的所有类型的数据</li></ul> <p><strong>登出</strong>，如果用户退出网站或服务，希望删除本地存储的数据。可以在https://example.com/logout的<strong>响应头</strong>增加Clear-Site-Data</p> <div class="language- extra-class"><pre class="language-text"><code>Clear-Site-Data: &quot;cache&quot;, &quot;cookies&quot;, &quot;storage&quot;, &quot;executionContexts&quot;
</code></pre></div><p>清除cookies，如果在https://example.com/clear-cookies的响应头中出现，则同一域和所有子域（如https://stage.example.com等）的所有Cookie，都会被清除</p> <div class="language- extra-class"><pre class="language-text"><code>Clear-Site-Data: &quot;cookies&quot;
</code></pre></div><ol start="19"><li><p>Connection：决定当前的事务完成后，是否会关闭网络连接。如果该值是“keep-alive”，网络连接就是持久不会关闭的。keep-alive不是必须填的</p></li> <li><p>Content-Disposition：指示回复的内容该以何种形式展示，以内联（<strong>inline</strong>）即网页或者页面的一部分，还是附件（attachment）的形式下载并保存到本地，大多数浏览器会呈现一个“保存为”的对话框，将filename的值预填为下载后的文件名</p></li></ol> <p>Content-Disposition: inline</p> <p>Content-Disposition: attachment</p> <p>Content-Disposition: attachment; filename=&quot;filename.jpg&quot;</p> <ol start="21"><li><p>Content-Encoding：实体消息首部，用于对特定媒体类型的数据进行压缩。对于特定类型的文件，比如jpeg图片文件，已经进行压缩过的，就不需要继续压缩</p></li> <li><p>Content-Language：用来说明访问者希望采用的语言或语言组合，这样的话用户就可以根据自己偏好的语言来定制不同的内容</p></li> <li><p>Content-Length：用来指名发送给接收方的消息主体的大小，用十进制数字表示</p></li> <li><p>Content-Location：首部指定的是要返回的数据的地址选项。最主要的用途是用来指定要访问的资源经过内容协商后的结果的URL</p></li></ol> <p><strong>Location</strong>-指定的是一个重定向请求的目的地址（或者新创建的文件的URL）-对应的是响应</p> <p>Content-Location-指向的是可供访问的资源的直接地址，不需要进行进一步的内容协商-对应的是要返回的实体</p> <ol start="25"><li>Content-Range：显示的是一个数据片段在整个文件中的位置</li></ol> <p>Content-Range: &lt;<strong>unit</strong>&gt;  &lt;<strong>range-start</strong>&gt;-&lt;<strong>range-end</strong>&gt;/&lt;<strong>size</strong>&gt;</p> <p>Content-Range: &lt;<strong>unit</strong>&gt;  &lt;<strong>range-start</strong>&gt;-&lt;<strong>range-end</strong>&gt;/*</p> <p>Content-Range: &lt;<strong>unit</strong>&gt;  */&lt;<strong>size</strong>&gt;</p> <p>unit-数据区间所采用的单位。通常是字节（byte）</p> <p>range-start-区间起始值</p> <p>range-end-区间的结束值</p> <p>size-整个文件的大小</p> <ol start="26"><li>Content-Security-Policy：允许站点管理者在指定的页面控制用户代理的资源。主要以白名单的形式配置可信任的内容来源，在网页中，能够使用白名单中的内容正常执行（包含JS、CSS、Image等），而非白名单的内容无法正常执行，这条策略将极大的指定服务源以及脚本端点。减少<strong>跨站点脚本攻击（XSS）</strong>，也能减少<strong>运营商劫持的内容注入攻击</strong></li></ol> <p>Head中添加Meta标签示例</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;script-src 'self'&quot;&gt;
</code></pre></div><p>不支持CSP的浏览器将会自动忽略CSP的信息，不会有什么影响</p> <p>当定义多个策略的时候，浏览器会优先采用最先定义的。</p> <table><thead><tr><th>指令</th> <th>取值示例</th> <th>说明</th></tr></thead> <tbody><tr><td>default-src</td> <td>'self' cdn.example.com</td> <td>定义针对所有类型（js/image/css/web font/ajax/iframe/多媒体等）资源的默认加载策略，某类型资源如果没有单独定义策略，就使用默认。</td></tr> <tr><td>script-src</td> <td>'self' js.example.com</td> <td>定义针对JavaScript的加载策略</td></tr> <tr><td>object-src</td> <td>'self'</td> <td>针对,, 等标签的加载策略</td></tr> <tr><td>style-src</td> <td>'self' css.example.com</td> <td>定义针对样式的加载策略</td></tr> <tr><td>img-src</td> <td>'self' image.example.com</td> <td>定义针对图片的加载策略</td></tr> <tr><td>media-src</td> <td>'media.example.com'</td> <td>针对或者引入的html多媒体等标签的加载策略</td></tr> <tr><td>frame-src</td> <td>'self'</td> <td>针对iframe的加载策略</td></tr> <tr><td>connect-src</td> <td>'self'</td> <td>针对Ajax、WebSocket等请求的加载策略。不允许的情况下，浏览器会模拟一个状态为400的响应</td></tr> <tr><td>font-src</td> <td>font.qq.com</td> <td>针对Web Font的加载策略</td></tr> <tr><td>sandbox</td> <td>allow-forms allow-scripts</td> <td>对请求的资源启用sandbox</td></tr> <tr><td>report-uri</td> <td>/some-report-uri</td> <td>告诉浏览器如果请求的资源不被策略允许时，往哪个地址提交日志信息。不阻止任何内容，可以改用Content-Security-Policy-Report-Only头</td></tr> <tr><td>base-uri</td> <td>'self'</td> <td>限制当前页面的url（CSP2）</td></tr> <tr><td>child-src</td> <td>'self'</td> <td>限制子窗口的源(iframe、弹窗等),取代frame-src（CSP2）</td></tr> <tr><td>form-action</td> <td>'self'</td> <td>限制表单能够提交到的源（CSP2）</td></tr> <tr><td>frame-ancestors</td> <td>'none'</td> <td>限制了当前页面可以被哪些页面以iframe,frame,object等方式加载（CSP2）</td></tr> <tr><td>plugin-types</td> <td>application/pdf</td> <td>限制插件的类型（CSP2）</td></tr> <tr><td>manitest-src</td> <td></td> <td>限制application manifest文件源</td></tr> <tr><td>worker-src</td> <td></td> <td>限制Worker，SharedWorker或者ServiceWorker脚本源</td></tr> <tr><td>disown-opener</td> <td></td> <td>确保资源在操作的时候能够脱离父页面</td></tr> <tr><td>navigation-to</td> <td></td> <td>限制文档可以通过以下任何方式访问URL（a，form，window.location，window.open，etc）</td></tr> <tr><td>report-to</td> <td></td> <td>Fires a <code>SecurityPolicyViolationEvent</code></td></tr></tbody></table> <p>指令值示例及说明</p> <table><thead><tr><th>指令值</th> <th>示例</th> <th>说明</th></tr></thead> <tbody><tr><td>*</td> <td>img-src *</td> <td>允许任何内容</td></tr> <tr><td>none'</td> <td>img-src 'none'</td> <td>不允许任何内容</td></tr> <tr><td>'self'</td> <td>img-src 'self'</td> <td>允许同源内容</td></tr> <tr><td>data:</td> <td>img-src data:</td> <td>允许data:协议（如base64编码的图片）</td></tr> <tr><td><a href="http://www.a.com/" target="_blank" rel="noopener noreferrer">www.a.com<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td> <td>img-src <a href="http://www.a.com/" target="_blank" rel="noopener noreferrer">www.a.com<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td> <td>允许加载指定域名的资源</td></tr> <tr><td>*.a.com</td> <td>img-src *.a.com</td> <td>允许加载a.com任何子域的资源</td></tr> <tr><td><a href="https://img.com/" target="_blank" rel="noopener noreferrer">https://img.com<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td> <td>img-src <a href="https://img.com/" target="_blank" rel="noopener noreferrer">https://img.com<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td> <td>允许加载img.com的https资源</td></tr> <tr><td>https:</td> <td>img-src https:</td> <td>允许加载https资源</td></tr> <tr><td>'unsafe-inline'</td> <td>script-src 'unsafe-inline'</td> <td>允许加载inline资源（style属性，onclick，inline js和inline css等等）</td></tr> <tr><td>'unsafe-eval'</td> <td>script-src 'unsafe-eval'</td> <td>允许加载动态js代码，例如eval()</td></tr></tbody></table> <p>CSP使用方式</p> <p>HTML Meta标签</p> <p>Meta标签主要含有两部分的key-value：</p> <ul><li>http-equiv</li> <li>content</li></ul> <div class="language- extra-class"><pre class="language-text"><code>&lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;script-src 'self'&quot;&gt;
</code></pre></div><p>HTTP Header</p> <p>通过HTTP header带上CSP的指令，可以支持所有请求</p> <div class="language- extra-class"><pre class="language-text"><code>Content-Security-Policy: script-src 'self' *.qq.com *.url.cn
</code></pre></div><ol start="27"><li><p>Content-Security-Policy-Report-Only：响应头允许通过监测策略，生成JSON文档，通过POST请求发送到指定的URI，该策略只会返回报告，不会阻止运行，这是和Content-Security-Policy的却别</p></li> <li><p>Content-Type：用于指示资源的MIME类型media type。在响应中，Content-Type标头告诉客户端实际返回的内容的内容类型。浏览器会在某些情况下进行MIME查找，并不一定遵循此标题的值；为了防止这种行为，可以将标题<strong>X-Content-Type-Options</strong>设置为<strong>nosniff</strong></p></li> <li><p>Cookie：存放由服务端通过Set-Cookie设置的HTTP cookies</p></li> <li><p>DNT（Do Not Track）：表明用户对于网站追踪的偏好。DNT: 0/1</p></li></ol> <p>0-表示用户愿意目标站点追踪用户个人信息</p> <p>1-表示用户不愿意目标站点追踪用户个人信息</p> <ol start="31"><li><p>Date：包含了消息生成的日期和时间</p></li> <li><p>Etag：资源的特定版本的标识符。让缓存更高效，并节省带宽，如果内容没有改变，Web服务器不需要发送完整的响应。Etag可以防止资源的同时更新相互覆盖（“空中碰撞”）</p></li></ol> <p>如果给定URL中的资源更改，则一定要生成新的Etag值。比较etags能快速确定此资源是否变化，但也可能被跟踪服务器永久存留。</p> <p>指令</p> <ul><li>'W/'表示使用弱验证器。弱验证器很容易生成，但不利于比较</li> <li>&quot;&lt;<strong>etag-value</strong>&gt;&quot;实体标签唯一表示所请求的资源。没有明确的算法实现，通常可以使用内容的散列，最后修改时间戳的哈希值，或简单的使用版本号方式</li></ul> <p><strong>避免“空中碰撞”</strong>- 使用Etag和If-Match头部实现</p> <p><strong>缓存未更改的资源</strong>-通过Etag和If-None-Match比较实现。1.用户再次访问给定的URL（设有ETag字段），显示资源过期了且不可用，客户端就发送值为ETag的IF-None-Match header字段 2.服务端将客户端的ETag与其当前版本的资源的ETag进行比较，如果两个值匹配，服务器将返回不带任何内容的304未修改状态，告诉客户端缓存版本可用</p> <ol start="33"><li><p>Expect：是一个请求消息头，包含一个期望条件，表示服务器只有在满足此期望条件的情况下才能妥善处理请求。</p></li> <li><p>Expires：响应头包含日期/时间，即在此时候之后，响应过期（http1.1）</p></li></ol> <p>如果在Cache-Control响应头中设置了&quot;max-age&quot;或者&quot;s-max-age&quot;指令，那么Expires头会被忽略</p> <ol start="35"><li>Forwarded：包含了代理服务器的客户端的信息，即由于代理服务在请求路径中的接入而被修改或丢失的信息。可以用X-Forwarded-For、X-Forwarded-Host、X-Forwarded-Proto替换。会暴露一定的隐私和敏感信息，比如客户端的IP地址。</li></ol> <div class="language- extra-class"><pre class="language-text"><code>Forwarded: by=&lt;identifier&gt;; for=&lt;identifier&gt;; host=&lt;host&gt;; proto=&lt;http|https&gt;
</code></pre></div><p>Identifier - 显示在使用代理的过程中被修改或者丢失的信息。</p> <ul><li>一个IP地址（V4或V6，ipv6地址需要包含在方括号里面，同时用括号括起来）</li> <li>语意不明的标识符（比如“_ hidden”或“_ secret”）</li> <li>&quot;unknown&quot;，当前信息实体不可知</li></ul> <p>by - 请求进入到代理服务器的接口</p> <p>for - 发起请求的客户端以及代理链中的一系列的代理服务器</p> <p>host - 代理接收到的Host首部的信息</p> <p>proto - 发起请求时采用的何种协议，通常是&quot;http&quot;或者&quot;https&quot;</p> <div class="language- extra-class"><pre class="language-text"><code># 大小写不敏感
Forwarded: For=&quot;[2001:db8:cafe::17]:4711&quot;

# for proto by 之间可用分号分隔
Forwarded: for=192.0.2.60; proto=http; by=203.0.113.43

# 多值可用逗号分隔
Forwarded: for=192.0.2.43, for=198.51.100.17
</code></pre></div><ol start="36"><li><p>Host：指名了服务器的域名，以及（可选的）服务器监听的TCP端口号。如果没有给定端口号，会自动使用被请求服务的默认端口（一般为80）HTTP1.1的所有请求报文中<strong>必须包含</strong>一个Host头字段。如果一个HTTP1.1请求缺少Host头字段或者设置了超过一个的Host头字段，会返回400状态码</p></li> <li><p>If-Match：表示是一个条件请求。在请求方法为GET和HEAD的情况下，服务器仅在请求的资源满足此首部列出的ETag之一时才会返回资源。而对于PUT或其他非安全方法来说，只有在满足条件的情况下才可以将资源上传</p></li> <li><p>If-Modified-Since：条件式请求首部，服务器只在所请求的资源在给定的日期时间之后对内容进行过修改的情况下才会将资源返回，状态码为200。如果请求的资源从那时未修改，那么返回一个不带有消息主体的304响应，而在<strong>Last-Modified</strong>首部中会带有上次修改时间。该<strong>请求参数只会在GET或者HEAD请求中使用</strong></p></li></ol> <p>当与If-None-Match一同出现时，会被忽略掉，除非服务器不支持If-None-Match</p> <ol start="39"><li><p>If-None-Match：表示是一个条件请求。对于GET和HEAD请求方法，当且仅当服务器上没有任何资源的ETag属性值与这个首部中列出的相匹配的时候，服务器端才会返回请求的资源，响应码200。对于其他方法来说，当且仅当最终确认没有已存在的资源的  <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/ETag" target="_blank" rel="noopener noreferrer"><code>ETag</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 属性值与这个首部中所列出的相匹配的时候，才会对请求进行相应的处理。</p></li> <li><p>If-Range：HTTP请求头字段用来使得Range头字段在一定条件下起作用：当字段值中的条件得到满足时，Range头字段才会起作用，同时服务器回复<strong>206</strong>部分内容状态码，以及Range头字段请求的响应部分；如果字段值中的条件没有得到满足，服务器将会返回200状态码，将返回完整的请求资源</p></li></ol> <p>If-Range头字段通常用于断点续传的下载过程中，用来自从上次中断后，确保下载的资源没有发生改变</p> <div class="language- extra-class"><pre class="language-text"><code>If-Range: &lt;星期&gt;, &lt;日&gt; &lt;月&gt; &lt;年&gt; &lt;时&gt;:&lt;分&gt;:&lt;秒&gt; GMT
If-Range: &lt;etag&gt;
</code></pre></div><ol start="41"><li>If-Unmodified-Since：用于请求中，使得当前请求称为条件式请求：只有当资源在指定的时间之后没有进行过修改的情况下，服务器才会返回请求的资源，或是接受POST或其他non-safe方法的请求。如果所请求的资源在指定的时间之后发生了修改，那么会返回412错误</li></ol> <p>应用场景：</p> <ul><li>与non-safe方式如POST搭配使用，可以用来优化并发控制</li> <li>与含有If-Range消息头的范围请求搭配使用，用来确保新的请求片段来自于未经修改的文档</li></ul> <ol start="42"><li><p>Keep-Alive（非标准）：允许消息发送者暗示连接的状态，还可以用来设置超时时长和最大请求数</p></li> <li><p>Large-Allocation(非标准)：用来告诉浏览器加载该页面可能需要申请大内存。当前只有Firefox实现。WebAssembly或者asm.js会使用比较大的连续内存空间。Large-Allocation告诉浏览器将要加载的页面可能需要申请一个大的连续内存空间，浏览器依据该头部可能会单独启动一个专有的进程用于处理该页面</p></li></ol> <p>指令：0- 是一个特殊值，代表分配的大小不确定（动态允许） &lt;<strong>megabytes</strong>&gt;- 预期需要申请的内存大小，以M为单位</p> <p>44, Last-Modified：响应首部，包含源头服务器认定的资源作出修改的日期及时间。</p> <ol start="45"><li><p>Location：首部指定的是需要将页面重新定向至的地址（状态码为303、307、308、301、302）或者新创建的文件的URL（状态为201）。一般在响应码为3XX的响应中才会有意义</p></li> <li><p>Origin：请求首部，指示请求来自于哪个站点。该字段指示服务器名称，并不包含任何路径信息。该首部用于<strong>POST</strong>或者<strong>CORS</strong>请求</p></li> <li><p>Proxy-Authenticate：响应首部，指定了获取proxy server（代理服务器）上的资源访问权限而采用的身份验证方式。代理服务器对请求进行验证，以便进一步传递请求。</p></li> <li><p>Proxy-Authentization：请求首部，其中包含了用户代理提供给代理服务器的用于身份验证的凭证</p></li> <li><p>Range：请求首部，告知服务器返回文件的哪一部分。在一个Range首部中，可以一次性请求多个部分，服务器会以multipart文件的形式将其返回。如果服务器返回的是范围响应，需要使用206状态码。</p></li></ol> <div class="language- extra-class"><pre class="language-text"><code>Range: &lt;unit&gt;=&lt;range-start&gt;-
Range: &lt;unit&gt;=&lt;range-start&gt;-&lt;range-end&gt;
Range: &lt;unit&gt;=&lt;range-start&gt;-&lt;range-end&gt;, &lt;range-start&gt;-&lt;range-end&gt;
Range: &lt;unit&gt;=&lt;range-start&gt;-&lt;range-end&gt;, &lt;range-start&gt;-&lt;range-end&gt;, &lt;range-start&gt;-&lt;range-end&gt;
</code></pre></div><ol start="50"><li>Referer：包含了当前请求页面的来源页面的地址，即表示当前页面是通过此来源页面里的链接进入的。服务端一般用该首部识别访问来源。</li></ol> <div class="language- extra-class"><pre class="language-text"><code>Referer首部可能暴露用户的浏览历史，涉及到用户的隐私问题
</code></pre></div><p>在以下两种情况下，Referer不会被发送：</p> <ul><li>来源页面采用的协议为表示本地文件的 &quot;file&quot; 或者 &quot;data&quot; URI；</li> <li>当前请求页面采用的是非安全协议，而来源页面采用的是安全协议（HTTPS）</li></ul> <ol start="51"><li>Referrer-Policy：用来监管哪些访问来源信息—会在Referer中发送—应该被包含在生成的请求当中</li></ol> <p>指令：</p> <ul><li>no-referrer- 整个referer首部会被移除</li> <li>no-referrer-when-downgrade（默认值）- 在没有指定任何策略的情况下用户代理的默认行为。在同等安全级别的情况下，引用页面的地址会被发送（HTTPS -&gt; HTTPS），但是在降级的情况下不会被发送（HTTPS-&gt;HTTP）</li> <li>origin- 在任何情况下，仅发送<strong>文件的源</strong>作为引用地址</li> <li>origin-when-cross-origin- 对于<strong>同源的请求</strong>，会发送<strong>完整的URL</strong>作为引用地址，但是对于<strong>非同源请求</strong>仅发送<strong>文件的源</strong></li> <li>same-origin- 对于同源的请求会发送引用地址，非同源不会发送</li> <li>strict-origin- 在同等安全级别的情况下，发送文件的源作为引用地址，降级的情况不会发送</li> <li>strict-origin-when-cross-origin- 对于同源的请求，会发送完整的URL作为引用地址；在同等安全级别的情况下，发送文件的源作为引用地址；在降级的情况下不发送此首部</li> <li>unsafe-url- 无论是同源请求还是非同源请求，都发送完整的URL作为引用地址</li></ul> <p>例子<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Referrer-Policy" target="_blank" rel="noopener noreferrer">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Referrer-Policy<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ol start="52"><li>Retry-After：响应首部，表示用户代理需要等待多长时间之后才能继续发送请求</li></ol> <ul><li>当与503（当前服务不存在）响应一起发送的时候，表示服务下线的预期时长</li> <li>当与重定向响应一起发送的时候，如301（永久迁移），表示用户代理在发送重定向请求之前需要等待的最短时间</li></ul> <ol start="53"><li>Set-Cookie：响应首部，被用来由服务器向客户端发送cookie</li></ol> <p>指令：</p> <p><strong>Expires</strong>=&lt;<strong>date</strong>&gt; cookie的最长有效时间，形式为符合HTTP-date规范的时间戳。如果没有设置这个属性，表示是一个<strong>会话期cookie</strong></p> <p><strong>Max-Age</strong>=&lt;<strong>non-zero-digit</strong>&gt; 在cookie失效之前需要经过的秒数。老的浏览器（ie6 7 8）不支持这个属性。Expires和Max-Age同时存在，Max-Age优先级更高</p> <p><strong>Domain</strong>=&lt;<strong>domain-value</strong> &gt; 指定cookie可以送达的主机名</p> <p><strong>Path</strong>=&lt;<strong>path-value</strong>&gt; 指定一个URL路径，这个路径必须出现在要请求的资源的路径中才可以发送Cookie首部。如果path=/docs，那么&quot;/docs&quot;，&quot;/docs/Web/&quot;或者&quot;/docs/Web/HTTP&quot;都满足匹配的条件</p> <p><strong>Secure</strong> 只有在请求使用SSL和HTTPS协议的时候才会被发送到服务器</p> <p><strong>HttpOnly</strong> 设置了HttpOnly属性的cookie不能使用Javascript经由Document.cookie属性、XMLHttpRequest和Request API上进行访问，防范跨站脚本攻击（XSS）</p> <p><strong>SameSite</strong>=<strong>Strict/Lax</strong> 设置后cookie不随跨域请求一起发送，一定程度上防范跨站请求伪造攻击（CSRF）</p> <ol start="54"><li><p>SourceMap HTTP响应头连接生成的代码到一个source map，使浏览器能够重建原始的资源然后显示在调试器里</p></li> <li><p>User-Agent 首部包含了一个特征字符串，用来让网络协议的对端来识别发起请求的用户代理软件的应用类型、操作系统、软件开发商以及版本号</p></li></ol> <div class="language- extra-class"><pre class="language-text"><code>User-Agent: &lt;product&gt; / &lt;product-version&gt; &lt;comment&gt;
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:47.0) Gecko/20100101 Firefox/47.0
Mozilla/5.0 (Macintosh; Intel Mac OS X x.y; rv:42.0) Gecko/20100101 Firefox/42.0
</code></pre></div><ol start="56"><li>Vary 响应头，决定了对于未来的一个请求头，应该用一个缓存的回复（response）还是向源服务器请求一个新的回复</li></ol> <h2 id="spdy-http2-0"><a href="#spdy-http2-0" aria-hidden="true" class="header-anchor">#</a> SPDY/HTTP2.0</h2> <p>HTTP2.0的目的是通过<code>支持请求与响应的多路复用</code>来减少延迟，通过<code>压缩HTTP首部字段</code>将协议开销降低至最低，同时增加对<code>请求优先级</code>和<code>服务端推送</code>的支持，修改了<code>流量控制</code>、<code>错误处理</code>和<code>更新机制</code>。</p> <p>HTTP2.0增加了<code>二进制分帧层</code>，定义了如何封装HTTP消息并在客户端与服务器之间传输。HTTP1.x以换行符作为纯文本的分隔符，HTTP2.0将所有传输的信息分割为更小的消息和帧，并对它们采用二进制格式的编码。</p> <h3 id="流、消息、帧"><a href="#流、消息、帧" aria-hidden="true" class="header-anchor">#</a> 流、消息、帧</h3> <ul><li>流 - 已建立的连接上的双向字节流</li> <li>消息 - 与逻辑消息对应的完整的一系列数据帧</li> <li>帧 - HTTP2.0的最小单位，每个帧包含<code>帧首部</code>，至少也会标识出当前帧所属的流</li></ul> <p>所有HTTP2.0通信都在一个连接上完成，这个连接可以承载任意数量的双向数据流。每个数据流以消息的形式发送，而消息由一到多个帧组成，这些帧可以乱序发送，然后再根据每个帧首部的流标识符重新组装</p> <h3 id="二进制分帧层"><a href="#二进制分帧层" aria-hidden="true" class="header-anchor">#</a> 二进制分帧层</h3> <p>HTTP2.0性能增强的核心，全在于新增的二进制分帧层。定义了如何封装HTTP消息并在客户端与服务器之间传输</p> <p><img src="http://www.reyshieh.com/assets/binary-frames.png" alt="binary-frames"></p> <p>&quot;层&quot;指的是位于套接字接口与应用可见的高层HTTP API之间的一个新机制，HTTP的语义不受影响，不同的是传输期间的编码发生了变化</p> <h3 id="二进制分帧"><a href="#二进制分帧" aria-hidden="true" class="header-anchor">#</a> 二进制分帧</h3> <p>HTTP2.0建立连接后，客户端与服务端会通过交换帧来通信，帧是基于这个新协议通信的最小单位。所有帧都共享一个8字节的首部，其中包含帧的长度、类型、标志，还有一个保留位和一个31位的流标识符</p> <p><img src="http://www.reyshieh.com/assets/http2-binary-summary.png" alt="http2-binary-summary"></p> <ul><li>16位的长度前缀意味着一帧大约可以携带64KB数据，不包括8字节首部</li> <li>8位的类型字段决定如何解释帧其余部分的内容</li> <li>8位的标志字段允许不同的帧类型定义特定于帧的消息标志</li> <li>1位保留字段始终为0</li> <li>31位的流标识符唯一标识HTTP2.0的流</li></ul> <p>帧类型包括：</p> <ul><li>DATA：用于传输HTTP消息体</li> <li>HEADERS：用于传输关于流的额外的首部字段</li> <li>PRIORITY：用于指定或重新指定引用资源的优先级</li> <li>RST_STREAM：用于通知流的非正常终止</li> <li>SETTINGS：用于通知两端通信方式的配置数据</li> <li>PUSH_PROMISE：用于发出创建流和服务器引用资源的要约</li> <li>PING：用于计算往返时间，执行“活性”检查</li> <li>GOAWAY：用于通知对端停止在当前连接中创建流</li> <li>WINDOW_UPDATE：用于针对个别流或个别连接实现流量控制</li> <li>CONTINUATION：用于继续一系列首部块片段</li></ul> <p>利用GOAWAY类型的帧，告诉客户端要处理的最后一个流ID，从而消除一些请求竞争，而且浏览器也可以据此智能地重试或取消&quot;悬着的&quot;请求，这是保证复用连接的一个重要功能</p> <p>在发送应用数据之前，必须创建一个<strong>新流</strong>并随之发送相应的元数据，比如流优先级、HTTP首部等。HTTP2.0规定客户端和服务器都可以发起新流，存在两种可能：</p> <ul><li><p>客户端通过发送HEADERS帧来发起新流，帧包含带有新流ID的公用首部、可选的31位优先值，以及一组HTTP键-值对首部</p> <p><img src="http://www.reyshieh.com/assets/http2-headers-priority.png" alt="http2-headers-priority"></p></li> <li><p>服务器通过发送PUSH_PROMISE帧来发起推送流，和HEADERS帧等效，但包含&quot;要约流ID&quot;，没有优先值</p></li> <li><p>HEADERS帧和PUSH_PROMISE帧都只用于沟通新流的元数据，净荷会在DATA帧中单独发送。规定，客户端发送的流具有奇数ID，服务器发起的流具有偶数ID。两端的流ID不会冲突，各自持有一个简单的计数器</p></li></ul> <h3 id="多向请求与响应"><a href="#多向请求与响应" aria-hidden="true" class="header-anchor">#</a> 多向请求与响应</h3> <p>二进制分帧层的加入，实现了多向请求和响应，客户端和服务器可以把HTTP消息分解为互不依赖的帧，然后乱序发送，最后再在另一端把它们重新组合起来</p> <p><img src="http://www.reyshieh.com/assets/http2-request-more.png" alt="http2-request-mor"></p> <blockquote><p>注意，HTTP2.0加入了多向请求与响应，为了优化HTTP1.x的方案，如拼接文件、图片精灵、域名分区都变得没有必要。而且这些优化有可能反而带来更大的消耗。同时这个方式减少TCP连接的数量，也会减少客户端和服务器CPU及内存占用</p></blockquote> <h3 id="请求优先级"><a href="#请求优先级" aria-hidden="true" class="header-anchor">#</a> 请求优先级</h3> <p>每个流都可以带有一个31比特的优先值：</p> <ul><li>0表示最高优先级</li> <li>2^31 - 1表示最低优先级</li></ul> <p>客户端和服务器可以在处理不同的流时采用不同的策略，以最优的方式发送流、消息和帧。</p> <p>HTTP2.0并没有规定处理优先级的具体算法，只是提供了一种赋予数据优先级的机制。因此，对应的次序排定策略可能因客户端或服务器的实现而不同：客户端应该明确指定优先值，服务器应该根据该值处理和交付数据</p> <p>但是，同样还是要考虑些问题。如果服务器不去理会所有优先值，那么可能会导致应用响应变慢，浏览器在需要等关键CSS和JS时，服务器却发送了图片，造成渲染阻塞。但是严格的优先级次序也可能带来次优的效果，因为可能又会引入队首阻塞问题，即某个高优先级的慢请求会不必要地阻塞其他资源的交付</p> <p>因此，服务器可以交错发送不同优先级的帧。只要可能，高优先级流都应该优先，包括分配处理资源和客户端与服务器间的带宽</p> <h3 id="流量控制"><a href="#流量控制" aria-hidden="true" class="header-anchor">#</a> 流量控制</h3> <p>HTTP2.0为数据流和连接的流量控制提供了一个简单的机制：</p> <ul><li>流量控制基于每一跳进行，并不是端到端的控制</li> <li>流量控制基于窗口更新帧进行，即接收方广播自己准备接收某个数据流的多少字节，以及对整个连接要接收多少字节</li> <li>流量控制窗口大小通过WINDOW_UPDATE帧更新，字段指定了流ID和窗口大小递增值</li> <li>流量控制有方向性，即接收方可能根据自己的情况为每个流乃至整个连接设置任意窗口大小</li> <li>流量控制可以由接收方禁用，包括针对个别的流和针对整个连接</li></ul> <h3 id="服务端推送"><a href="#服务端推送" aria-hidden="true" class="header-anchor">#</a> 服务端推送</h3> <p>HTTP2.0允许服务器对客户端请求发送多个响应。除了最初请求的响应外，服务器还可以额外向客户端推送资源，无需客户端明确地请求</p> <p>服务器将资源直接推送给客户端，带来了好处：</p> <ul><li>客户端可以缓存推送过来的资源</li> <li>客户端可以拒绝推送过来的资源</li> <li>推送资源可以由不同的页面共享</li> <li>服务器可以按照优先级推送资源</li></ul> <p>推送的资源必须遵循同源策略。服务器不能随便讲第三方资源推送给客户端，必须是经过双方确认的才行</p> <p>推送的资源将直接进入客户端缓存</p> <h3 id="首部压缩"><a href="#首部压缩" aria-hidden="true" class="header-anchor">#</a> 首部压缩</h3> <p>HTTP2.0在客户端和服务器端使用&quot;首部表&quot;来跟踪和存储之前发送的键-值对，相同的数据不再通过每次请求和响应发送</p> <p>首部表在HTTP2.0的链接存续期内始终存在，由客户端和服务器共同渐进地更新</p> <p>每个新的首部键-值对要么被追加到当前表的末尾，要么替换表中的值</p> <p><img src="http://www.reyshieh.com/assets/http2-header-diff.png" alt="http2-header-diff"></p> <h3 id="http2-0升级与发现"><a href="#http2-0升级与发现" aria-hidden="true" class="header-anchor">#</a> HTTP2.0升级与发现</h3> <p>因为HTTP1.x在短时间内是不会去除的，存在很长一段时间内HTTP1.x和HTTP2.0并存。于是，支持HTTP2.0的客户端在发起请求之前，必须能发现服务器及所有中间设备是否支持HTTP2.0协议。存在三种情况：</p> <ul><li>通过TLS和ALPN(应用层协议协商，Application Layer Protocol Negotiation)发起新的HTTPS连接</li> <li>根据之前的信息发送新的HTTP连接</li> <li>没有之前的信息而发起新的HTTP连接</li></ul> <p>减少网络延迟是HTTP2.0的关键条件，因此在建立HTTPS连接时一定会用到ALPN协商</p> <p>HTTP1.0和HTTP2.0都使用同一个端口(80)，且没有服务器是否支持HTTP2.0的其他任何信息，此时客户端只能使用HTTP upgrade机制通过协调确定适当的协议</p> <div class="language- extra-class"><pre class="language-text"><code>GET /page HTTP/1.1
Host server.example.com
Connection: Upgrade, HTTP2-Settings
Upgrade: HTTP/2.0
HTTP2-Settings: (SETTINGS payload)

// 响应 http1.1方式
HTTP/1.1 200 OK
Content-length: 243
Content-type: text/html
// 响应 http2.0方式
HTTP/1.1 101 Switching Protocols
Connection: Upgrade
Upgrade: HTTP/2.0
</code></pre></div><p>如果客户端因为自己保存有或通过其他手段（如DNS记录、手工配置等）获得了关于HTTP2.0的支持信息，也可以直接发送HTTP2.0分帧，而不必依赖Upgrade机制</p> <p>最坏的情况就是无法建立连接，客户端再回退一步。重新使用Upgrade首部，或者切换到带ALPN协商的TLS信道</p> <h3 id="http1-x和2-0相互转换"><a href="#http1-x和2-0相互转换" aria-hidden="true" class="header-anchor">#</a> HTTP1.x和2.0相互转换</h3> <p>如果客户端与服务器端不能保证两端同事支持HTTP2.0，那么可以新增一个转换层，使1.x服务器利用HTTP2.0</p> <p>一台服务器可以接受HTTP2.0会话，处理之后再向既有基础设施分派1.x格式的请求。接到响应后，再将其转换成HTTP2.0的流返回给客户端</p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/knowledge-note/knowledge/Damn-hole-of-design-patterns.html" class="prev">
          设计模式
        </a></span> <span class="next"><a href="/knowledge-note/knowledge/Damn-hole-of-common-plugin.html">
          常用插件包问题
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/knowledge-note/assets/js/17.2b5e8c6e.js" defer></script><script src="/knowledge-note/assets/js/app.a571e02f.js" defer></script>
  </body>
</html>
